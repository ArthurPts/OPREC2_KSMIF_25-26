<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Encrypt / Decrypt Teks — AES‑GCM</title>
  <style>
    :root{--bg:#0b1220;--card:#071428;--accent:#06b6d4;--muted:#94a3b8}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;margin:0;background:linear-gradient(180deg,#020617,#071633);color:#e6eef6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .wrap{width:100%;max-width:820px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.04));border-radius:12px;padding:20px;box-shadow:0 10px 30px rgba(2,6,23,0.7)}
    h1{font-size:18px;margin:0 0 6px}
    p.lead{margin:0 0 16px;color:var(--muted);font-size:13px}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    textarea{width:100%;min-height:180px;padding:12px;border-radius:8px;background:#061428;border:1px solid rgba(255,255,255,0.03);color:inherit;resize:vertical}
    input[type="password"], input[type="text"]{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:#061528;color:inherit;width:100%}
    .row{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);border:none;padding:10px 12px;border-radius:8px;color:#022;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(255,255,255,0.04)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    footer{margin-top:12px;color:var(--muted);font-size:13px}
    .full{grid-column:1/-1}
    .small{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Encrypt / Decrypt Teks</h1>
    <p class="lead"></p>

    <div style="margin-bottom:8px">
      <label for="password">Password / Passphrase</label>
      <input id="password" type="password" placeholder="Masukkan password kuat..." autocomplete="new-password" />
    </div>

    <div class="cols">
      <div>
        <label for="plaintext">Plaintext (masukkan teks untuk dienkripsi)</label>
        <textarea id="plaintext" placeholder="Tulis teks di sini..."></textarea>
        <div class="controls">
          <button id="encryptBtn">Encrypt → Ciphertext</button>
          <button id="clearPlain" class="ghost">Clear</button>
        </div>
      </div>

      <div>
        <label for="ciphertext">Ciphertext (base64) — paste untuk didecrypt</label>
        <textarea id="ciphertext" placeholder="Hasil enkripsi akan muncul di sini, atau paste ciphertext untuk didecrypt..."></textarea>
        <div class="controls">
          <button id="decryptBtn">Decrypt → Plaintext</button>
          <button id="clearCipher" class="ghost">Clear</button>
        </div>
      </div>

      <div class="full">
        </div>
      </div>
    </div>

    
  </div>

  <script>
    // Helpers
    const utf8 = new TextEncoder();
    const dec = new TextDecoder();
    const iterEl = document.getElementById('iter');
    const ITER = 100000; // kept constant here for simplicity

    function toBase64(bytes){
      // bytes: Uint8Array
      let binary = '';
      const chunkSize = 0x8000;
      for (let i = 0; i < bytes.length; i += chunkSize) {
        binary += String.fromCharCode.apply(null, bytes.subarray(i, i + chunkSize));
      }
      return btoa(binary);
    }
    function fromBase64(b64){
      const binary = atob(b64);
      const len = binary.length;
      const bytes = new Uint8Array(len);
      for (let i = 0; i < len; i++) bytes[i] = binary.charCodeAt(i);
      return bytes;
    }

    async function deriveKey(password, salt, iterations=ITER){
      const pwKey = await crypto.subtle.importKey('raw', utf8.encode(password), 'PBKDF2', false, ['deriveKey']);
      return crypto.subtle.deriveKey({name:'PBKDF2', salt, iterations, hash:'SHA-256'}, pwKey, {name:'AES-GCM', length:256}, false, ['encrypt','decrypt']);
    }

    async function encryptText(plaintext, password){
      const salt = crypto.getRandomValues(new Uint8Array(16));
      const iv = crypto.getRandomValues(new Uint8Array(12));
      const key = await deriveKey(password, salt);
      const ct = await crypto.subtle.encrypt({name:'AES-GCM', iv}, key, utf8.encode(plaintext));
      // concat salt + iv + ciphertext
      const ctBytes = new Uint8Array(ct);
      const out = new Uint8Array(salt.length + iv.length + ctBytes.length);
      out.set(salt, 0);
      out.set(iv, salt.length);
      out.set(ctBytes, salt.length + iv.length);
      return toBase64(out);
    }

    async function decryptText(b64, password){
      try{
        const data = fromBase64(b64);
        if (data.length < 16+12+16) throw new Error('Ciphertext terlalu pendek');
        const salt = data.slice(0,16);
        const iv = data.slice(16,28);
        const ct = data.slice(28);
        const key = await deriveKey(password, salt);
        const plainBuf = await crypto.subtle.decrypt({name:'AES-GCM', iv}, key, ct);
        return dec.decode(plainBuf);
      }catch(e){
        throw new Error('Gagal dekripsi — password salah atau data corrupt');
      }
    }

    // UI bindings
    const encryptBtn = document.getElementById('encryptBtn');
    const decryptBtn = document.getElementById('decryptBtn');
    const pwdEl = document.getElementById('password');
    const plainEl = document.getElementById('plaintext');
    const cipherEl = document.getElementById('ciphertext');
    const clearPlain = document.getElementById('clearPlain');
    const clearCipher = document.getElementById('clearCipher');

    iterEl.textContent = ITER.toLocaleString();

    encryptBtn.addEventListener('click', async ()=>{
      const pwd = pwdEl.value;
      const pt = plainEl.value;
      if (!pwd) return alert('Masukkan password terlebih dahulu');
      if (!pt) return alert('Masukkan teks yang ingin dienkripsi');
      try{
        encryptBtn.disabled = true;
        encryptBtn.textContent = 'Encrypting...';
        const out = await encryptText(pt, pwd);
        cipherEl.value = out;
      }catch(e){
        alert('Error saat enkripsi: ' + e.message);
      }finally{
        encryptBtn.disabled = false;
        encryptBtn.textContent = 'Encrypt → Ciphertext';
      }
    });

    decryptBtn.addEventListener('click', async ()=>{
      const pwd = pwdEl.value;
      const ct = cipherEl.value.trim();
      if (!pwd) return alert('Masukkan password terlebih dahulu');
      if (!ct) return alert('Paste ciphertext terlebih dahulu');
      try{
        decryptBtn.disabled = true;
        decryptBtn.textContent = 'Decrypting...';
        const out = await decryptText(ct, pwd);
        plainEl.value = out;
      }catch(e){
        alert('Gagal dekripsi: ' + e.message);
      }finally{
        decryptBtn.disabled = false;
        decryptBtn.textContent = 'Decrypt → Plaintext';
      }
    });

    clearPlain.addEventListener('click', ()=> plainEl.value = '');
    clearCipher.addEventListener('click', ()=> cipherEl.value = '');
  </script>
</body>
</html>